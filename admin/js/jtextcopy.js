(function(e){e.fn.textcopy=function(t){var n={id:"textcopy",text:"»сточник",minlen:50,first:false};e.extend(n,t);var r=document.createElement("span");r.id=n.id;r.style.position="absolute";r.style.overflow="hidden";r.style.margin="5px 0 0 -1px";r.style.lineHeight="0";r.style.opacity="0";r.style.width="1px";r.style.height="1px";r.innerHTML="<br />"+n.text+': <a href="'+window.location.href+'">'+window.location.href+"</a><br />";var i=function(){e(this).on({mousedown:function(){var e=document.getElementById(n.id);if(e){e.parentNode.removeChild(e)}},mouseup:function(){var e=document.activeElement.tagName.toLowerCase();if(e!=="textarea"&&e!=="input"){if(window.getSelection){var t=window.getSelection();var i=t.toString();if(i&&i.length>=n.minlen){var s=t.getRangeAt(0);i=s.cloneRange();i.collapse(n.first);i.insertNode(r);if(!n.first){s.setEndAfter(r)}t.removeAllRanges();t.addRange(s)}}else if(document.selection){var t=document.selection;var s=t.createRange();var i=s.text;if(i&&i.length>=n.minlen){i=s.duplicate();i.collapse(n.first);i.pasteHTML(r.outerHTML);if(!n.first){s.setEndPoint("EndToEnd",i);s.select()}}}}}})};return this.each(i)}})(jQuery)
