(function(e){e.extend({progressBar:new function(){this.defaults={steps:20,stepDuration:20,max:100,showText:true,textFormat:"percentage",width:120,height:12,callback:null,boxImage:"images/progressbar.gif",barImage:{0:"images/progressbg_red.gif",30:"images/progressbg_orange.gif",70:"images/progressbg_green.gif"},running_value:0,value:0,image:null};this.construct=function(t,n){var r=null;var i=null;if(t!=null){if(!isNaN(t)){r=t;if(n!=null){i=n}}else{i=t}}return this.each(function(t){function c(e){return e.running_value*100/e.max}function h(e){var t=e.barImage;if(typeof e.barImage=="object"){for(var n in e.barImage){if(e.running_value>=parseInt(n)){t=e.barImage[n]}else{break}}}return t}function p(e){if(e.showText){if(e.textFormat=="percentage"){return" "+Math.round(e.running_value)+"%"}else if(e.textFormat=="fraction"){return" "+e.running_value+"/"+e.max}}}var n=this;var s=this.config;if(r!=null&&this.bar!=null&&this.config!=null){this.config.value=r;if(i!=null)n.config=e.extend(this.config,i);s=n.config}else{var o=e(this);var s=e.extend({},e.progressBar.defaults,i);s.id=o.attr("id")?o.attr("id"):Math.ceil(Math.random()*1e5);if(r==null)r=o.html().replace("%","");s.value=r;s.running_value=0;s.image=h(s);o.html("");var u=document.createElement("img");var a=document.createElement("span");var f=e(u);var l=e(a);n.bar=f;f.attr("id",s.id+"_pbImage");l.attr("id",s.id+"_pbText");l.html(p(s));f.attr("title",p(s));f.attr("alt",p(s));f.attr("src",s.boxImage);f.attr("width",s.width);f.css("width",s.width+"px");f.css("height",s.height+"px");f.css("background-image","url("+s.image+")");f.css("background-position",s.width*-1+"px 50%");f.css("padding","0");f.css("margin","0");o.append(f);o.append(l)}s.increment=Math.round((s.value-s.running_value)/s.steps);if(s.increment<0)s.increment*=-1;if(s.increment<1)s.increment=1;var d=setInterval(function(){var t=s.width/100;if(s.running_value>s.value){if(s.running_value-s.increment<s.value){s.running_value=s.value}else{s.running_value-=s.increment}}else if(s.running_value<s.value){if(s.running_value+s.increment>s.value){s.running_value=s.value}else{s.running_value+=s.increment}}if(s.running_value==s.value)clearInterval(d);var r=e("#"+s.id+"_pbImage");var i=e("#"+s.id+"_pbText");var o=h(s);if(o!=s.image){r.css("background-image","url("+o+")");s.image=o}r.css("background-position",s.width*-1+c(s)*t+"px 50%");r.attr("title",p(s));i.html(p(s));if(s.callback!=null&&typeof s.callback=="function")s.callback(s);n.config=s},s.stepDuration)})}}});e.fn.extend({progressBar:e.progressBar.construct})})(jQuery)