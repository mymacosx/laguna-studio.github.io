(function(e){e.suggest=function(t,n){function l(){var e=r.offset();i.css({top:e.top+t.offsetHeight+"px",left:e.left+"px"})}function c(e){if(/27$|38$|40$/.test(e.keyCode)&&i.is(":visible")||/^13$|^9$/.test(e.keyCode)&&g()){if(e.preventDefault)e.preventDefault();if(e.stopPropagation)e.stopPropagation();e.cancelBubble=true;e.returnValue=false;switch(e.keyCode){case 38:w();break;case 40:b();break;case 9:case 13:y();break;case 27:i.hide();break}}else if(r.val().length!=o){if(s)clearTimeout(s);s=setTimeout(h,n.delay);o=r.val().length}}function h(){var t=e.trim(r.val());if(t.length>=n.minchars){cached=p(t);if(cached){v(cached["items"])}else{e.get(n.source,{q:t},function(e){i.hide();var n=m(e,t);v(n);d(t,n,e.length)})}}else{i.hide()}}function p(e){for(var t=0;t<u.length;t++)if(u[t]["q"]==e){u.unshift(u.splice(t,1)[0]);return u[0]}return false}function d(e,t,r){while(u.length&&a+r>n.maxCacheSize){var i=u.pop();a-=i["size"]}u.push({q:e,size:r,items:t});a+=r}function v(t){if(!t)return;if(!t.length){i.hide();return}var r="";for(var s=0;s<t.length;s++)r+="<li>"+t[s]+"</li>";i.html(r).show();i.children("li").mouseover(function(){i.children("li").removeClass(n.selectClass);e(this).addClass(n.selectClass)}).click(function(e){e.preventDefault();e.stopPropagation();y()})}function m(t,r){var i=[];var s=t.split(n.delimiter);for(var o=0;o<s.length;o++){var u=e.trim(s[o]);if(u){u=u.replace(new RegExp(r,"ig"),function(e){return'<span class="'+n.matchClass+'">'+e+"</span>"});i[i.length]=u}}return i}function g(){if(!i.is(":visible"))return false;var e=i.children("li."+n.selectClass);if(!e.length)e=false;return e}function y(){$currentResult=g();if($currentResult){r.val($currentResult.text());i.hide();if(n.onSelect)n.onSelect.apply(r[0])}}function b(){$currentResult=g();if($currentResult)$currentResult.removeClass(n.selectClass).next().addClass(n.selectClass);else i.children("li:first-child").addClass(n.selectClass)}function w(){$currentResult=g();if($currentResult)$currentResult.removeClass(n.selectClass).prev().addClass(n.selectClass);else i.children("li:last-child").addClass(n.selectClass)}var r=e(t).attr("autocomplete","off");var i=e(document.createElement("ul"));var s=false;var o=0;var u=[];var a=0;i.addClass(n.resultsClass).appendTo("body");l();e(window).load(l).resize(l);r.blur(function(){setTimeout(function(){i.hide()},200)});try{i.bgiframe()}catch(f){}if(e.browser.mozilla)r.keypress(c);else r.keydown(c)};e.fn.suggest=function(t,n){if(!t)return;n=n||{};n.source=t;n.delay=n.delay||100;n.resultsClass=n.resultsClass||"ac_results";n.selectClass=n.selectClass||"ac_over";n.matchClass=n.matchClass||"ac_match";n.minchars=n.minchars||2;n.delimiter=n.delimiter||"\n";n.onSelect=n.onSelect||false;n.maxCacheSize=n.maxCacheSize||65536;this.each(function(){new e.suggest(this,n)});return this}})(jQuery)